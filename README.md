# 大檔案日誌產生器使用指南

## 🎯 功能概述

`generate_large_files.py` 是一個記憶體優化的 CDN 日誌產生器，支援自訂輸出目錄和智慧記憶體管理。

## 🚀 新增功能

### 1. 自訂輸出目錄
- 程式啟動時會要求使用者輸入輸出目錄
- 支援預設目錄 `/Users/jojo.yao/Downloads/Ali_test_log`
- 自動檢查目錄權限和現有檔案
- 可選擇清理現有測試檔案

### 2. 記憶體優化
- **系統資源檢查**：執行前檢查記憶體和磁碟空間
- **即時記憶體監控**：處理過程中持續監控記憶體使用率
- **自動垃圾回收**：記憶體使用率超過 85% 時自動執行垃圾回收
- **記憶體警告**：使用率超過 90% 時停止執行
- **分層處理優化**：每10個目錄執行一次垃圾回收

## 📋 安裝依賴

```bash
pip install psutil
# 或
pip install -r requirements.txt
```

## 🎮 使用方式

1. **執行程式**
   ```bash
   python generate_large_files.py
   ```

2. **系統資源檢查**
   程式會顯示：
   - 可用記憶體
   - 記憶體使用率
   - 可用磁碟空間

3. **設定輸出目錄**
   - 輸入自訂路徑或按 Enter 使用預設
   - 程式會檢查目錄權限和現有檔案

4. **選擇產生方案**
   - 方案 1：3500個檔案，每檔10000筆 (分層目錄)
   - 方案 2：1000個檔案，每檔35000筆 (分層目錄)
   - 方案 3：350個檔案，每檔100000筆 (單層目錄)
   - 方案 4：10個檔案，每檔100筆 (測試用)

## ⚠️ 記憶體管理機制

- **執行前檢查**：記憶體使用率 > 80% 會發出警告
- **執行中監控**：記憶體使用率 > 85% 執行垃圾回收
- **安全停止**：記憶體使用率 > 90% 停止執行
- **優化建議**：高記憶體使用時建議選擇分層目錄結構

## 📊 輸出格式

- **檔案名稱**：`qatest_NNNNNN.log.gz`
- **分層結構**：`batch_NNN/qatest_NNNNNN.log.gz`
- **壓縮格式**：gzip
- **時間戳記**：使用當前執行時間

## 🛠️ 故障排除

### 記憶體不足
```
❌ 記憶體不足，建議重啟程式或選擇較小的方案
```
**解決方案**：
1. 關閉其他應用程式
2. 選擇較小的方案
3. 重啟系統

### 目錄權限問題
```
❌ 目錄 '/path/to/dir' 沒有寫入權限
```
**解決方案**：
1. 選擇有寫入權限的目錄
2. 使用 `chmod` 修改權限

### 磁碟空間不足
```
⚠️ 警告: 磁碟空間不足 5GB
```
**解決方案**：
1. 清理磁碟空間
2. 選擇較小的方案
3. 更換輸出目錄到其他磁碟

## 📈 效能建議

1. **選擇適當方案**：根據系統記憶體選擇合適的檔案數量
2. **使用分層目錄**：大量檔案時優先選擇分層目錄結構
3. **監控資源**：注意記憶體和磁碟空間使用情況
4. **批次處理**：超大型任務建議分批執行
